#
# Copyright (c) 2021 Fraunhofer-Gesellschaft zur Foerderung der angewandten Forschung e. V.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
@prefix phys_unit: <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationPhysicalUnit/3/0/RC01/> .
@prefix dash: <http://datashapes.org/dash#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix vann: <http://purl.org/vocab/vann/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix aas: <https://admin-shell.io/aas/3/0/RC01/> .
@prefix iec61360: <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/> .
@prefix iecType: <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataTypeIEC61360/> .
@base <https://admin-shell.io/aas/3/0/RC01/> .


# AASd-002
aas:IdShortShape a sh:NodeShape ;
  sh:targetClass aas:Submodel ;
  sh:property [
      a sh:PropertyShape ;
      sh:path <https://admin-shell.io/aas/3/0/RC01/Referable/idShort> ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:message "(IdShortShape): idShort of Referables shall only feature letters, digits, underscore (\"_\"); starting mandatory with a letter. I.e. [a-zA-Z][a-zA-Z0-9_]+."^^xsd:string ;
      sh:pattern "^[a-zA-Z]\\w*$"^^xsd:string ;
    ] ;
.


# AASd-005
aas:RevisionRequiresVersionShape
	a sh:NodeShape ;
	sh:targetClass aas:AdministrativeInformation ;
	sh:message "(RevisionRequiresVersionShape): AASd-005 - A revision requires a version." ^^xsd:string ;
	sh:or (
		[
			sh:property [
				sh:path <https://admin-shell.io/aas/3/0/RC01/AdministrativeInformation/revision> ;
				sh:minCount 0 ;
				sh:maxCount 0 ;
			]
		]
		[
			sh:and (
				sh:property [
					sh:path <https://admin-shell.io/aas/3/0/RC01/AdministrativeInformation/revision> ;
					sh:minCount 1 ;
					sh:maxCount 1 ;
				]
				sh:property [
					sh:path <https://admin-shell.io/aas/3/0/RC01/AdministrativeInformation/version> ;
					sh:minCount 1 ;
					sh:maxCount 1 ;
				]
			)
		]
	)
.

# AASd-006
aas:AASd-006Shape  a sh:NodeShape ;
  sh:targetClass aas:Qualifier ;
  sh:sparql [
    a sh:SPARQLConstraint ;
    sh:message "If both, the value and the valueId of a Qualifier are present then the value needs to be identical to the value of the referenced coded value in Qualifier/valueId." ;
    sh:select """
      SELECT ?qualifier ?value
         WHERE {
           ?qualifier <https://admin-shell.io/aas/3/0/RC01/Qualifier/value> ?value .
           ?qualifier <https://admin-shell.io/aas/3/0/RC01/Qualifier/valueId> ?valueId .
           ?valueId <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?key .
           ?key <https://admin-shell.io/aas/3/0/RC01/Key/value> ?keyValue .

           FILTER (?value != ?keyValue)
      }
          """ ;
  ] ;
.

# AASd-007Shape
aas:AASd-007Shape  a sh:NodeShape ;
sh:targetClass aas:Property;
sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If both, the Property/value and the Property/valueId are present then the value of Property/value needs to be identical to the value of the referenced coded value in Property/valueId." ;
  sh:prefixes rdf: ;
  sh:select """
    SELECT ?property ?value WHERE {
         ?property a <https://admin-shell.io/aas/3/0/RC01/Property> .
         ?property <https://admin-shell.io/aas/3/0/RC01/Property/value> ?value .
         ?property <https://admin-shell.io/aas/3/0/RC01/Property/valueId> ?valueId .
         ?valueId <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?key .
         ?key <https://admin-shell.io/aas/3/0/RC01/Key/value> ?keyValue .

         FILTER (?value != ?keyValue)
    }""" ;
] .

# AASd-008
aas:AASd-008Shape a sh:NodeShape ;
  sh:targetClass aas:Operation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path <https://admin-shell.io/aas/3/0/RC01/HasKind/kind> ;
      sh:class aas:ModelingKind ;
      sh:minCount 1 ;
      sh:minCount 1 ;
      sh:hasValue <https://admin-shell.io/aas/3/0/RC01/ModelingKind/TEMPLATE> ; # TODO: rewrite to .../Template
      sh:message "(Operation.kind = Template):The submodel element value of an operation variable shall be of kind=Template."^^xsd:string ;
    ] ;
.

# AASd-014
aas:SelfManagedEntityRequiresAssetIdShape a sh:NodeShape ;
  rdfs:subClassOf aas:SubmodelElementShape ;
  sh:targetClass aas:Entity ;
  sh:message "(SelfManagedEntityRequiresAssetIdShape): AASd-014 - Either the attribute globalAssetId or specificAssetId of an Entity must be set if Entity/entityType is set to “SelfManagedEntity”. They are not existing otherwise." ^^xsd:string ;

  sh:xone(
	[
		sh:and(
			[
				sh:property [
					a sh:PropertyShape ;
					sh:path <https://admin-shell.io/aas/3/0/RC01/Entity/entityType> ;
					sh:minCount 1;
					sh:maxCount 1;
					sh:pattern "SELF_MANAGED_ENTITY";
				];
			]
			[
				sh:xone(
						[
							sh:property [
								sh:path <https://admin-shell.io/aas/3/0/RC01/Entity/globalAssetId>;
								sh:minCount 1;
								sh:maxCount 1;
							];
						]
						[
							sh:property [
								sh:path <https://admin-shell.io/aas/3/0/RC01/Entity/specificAssetId>;
								sh:minCount 1;
								sh:maxCount 1;
							];
						]
					)
			]
		)
	]
	[
	sh:and(
			[
			sh:property [
				a sh:PropertyShape ;
				sh:path <https://admin-shell.io/aas/3/0/RC01/Entity/entityType> ;
				sh:minCount 1;
				sh:maxCount 1;
				sh:pattern "CO_MANAGED_ENTITY";
			];
			]
			[
				sh:property [
					sh:path <https://admin-shell.io/aas/3/0/RC01/Entity/globalAssetId>;
					sh:minCount 0;
					sh:maxCount 0;
			];
			]
			[
				sh:property [
					sh:path <https://admin-shell.io/aas/3/0/RC01/Entity/specificAssetId>;
					sh:minCount 0;
					sh:maxCount 0;
				];
			]
		)
	]
)
.

# AASd-015
aas:AASd-015Shape  a sh:NodeShape ;
  sh:targetClass aas:AccessControl;
  sh:sparql [
    a sh:SPARQLConstraint ;
    sh:message "(AASd-015Shape) - The data element SubjectAttributes/subjectAttribute shall be part of the submodel that is referenced within the “selectableSubjectAttributes” attribute of “AccessControl”" ;
    sh:select """
      SELECT ?submodelElement WHERE {
           ?accessControl  <https://admin-shell.io/aas/3/0/RC01/AccessControl/selectableSubjectAttributes> ?submodel .
           ?submodel  <https://admin-shell.io/aas/3/0/RC01/Submodel/submodelElement> ?submodelElement .
		       ?submodelElement <https://admin-shell.io/aas/3/0/RC01/AccessPermissionRule/targetSubjectAttributes> ?subjectAttribute .
		       ?subjectAttribute  <https://admin-shell.io/aas/3/0/RC01/SubjectAttributes/subjectAttribute> ?dataElement .
    }"""
  ] ;
.

# AASd-020
aas:AASd-020Shape  a sh:NodeShape ;
  sh:targetClass aas:Qualifier ;
  sh:property [
      a sh:PropertyShape ;
      sh:path <https://admin-shell.io/aas/3/0/RC01/Qualifier/value> ;
      sh:sparql [
      	a sh:SPARQLConstraint ;
      	sh:message "(AASd-020Shape) - The value of Qualifier/value shall be consistent to the data type as defined in Qualifier/valueType." ;
      	sh:select """
      	  SELECT ?this ?value WHERE {
      		?this <https://admin-shell.io/aas/3/0/RC01/Qualifier/value> ?value .
            ?this <https://admin-shell.io/aas/3/0/RC01/Qualifier/valueType> ?valueType .
      		FILTER (DATATYPE(?value) != URI(?valueType) ) # TODO only works with complete URIs, for instance ?valueType:='http://www.w3.org/2001/XMLSchema#string' works but ?valueType:='string' fails.
      	  }
      	"""
     ]
    ];
.

# AASd-021
aas:AASd-021Shape  a sh:NodeShape ;
  sh:targetClass aas:Qualifiable ;
  sh:property [
      a sh:PropertyShape ;
      #sh:path <https://admin-shell.io/aas/3/0/RC01/Qualifiable/valueType> ;
      sh:sparql [
      	a sh:SPARQLConstraint ;
      	sh:message "(AASd-021Shape) - Every Qualifiable can only have one Qualifier with the same Qualifier/type." ;
      	sh:select """
      	  SELECT ?this ?valueType WHERE {
      	    ?qualifiable <https://admin-shell.io/aas/3/0/RC01/Qualifiable/qualifier> ?qualifier1 .
      	    ?qualifiable <https://admin-shell.io/aas/3/0/RC01/Qualifiable/qualifier> ?qualifier2 .
            ?qualifier1 <https://admin-shell.io/aas/3/0/RC01/Qualifier/valueType> ?valueType1 .
            ?qualifier2 <https://admin-shell.io/aas/3/0/RC01/Qualifier/valueType> ?valueType2 .
      		FILTER (str(?valueType1) = str(?valueType2) )
      	  }
      	"""
     ]
    ];
.

# AASd-051
aas:ConceptDescriptionAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:ConceptDescription ;

  sh:property [
      a sh:PropertyShape ;
      sh:path <https://admin-shell.io/aas/3/0/RC01/Referable/category> ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 0 ;
      sh:pattern "^VALUE|^PROPERTY|^REFERENCE|^DOCUMENT|^CAPABILITY|^RELATIONSHIP|^COLLECTION|^FUNCTION|^EVENT|^ENTITY|^APPLICATION_CLASS|^QUALIFIER|^VIEW";
	  sh:message "A ConceptDescription shall have one of the following categories: VALUE, PROPERTY, REFERENCE, DOCUMENT, CAPABILITY, RELATIONSHIP, COLLECTION, FUNCTION, EVENT, ENTITY, APPLICATION_CLASS, QUALIFIER, VIEW." ^^xsd:string ;
    ] ;
.

# AASd-052a
aas:ConceptDescriptionReferencedFromPropertyAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:Property ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a Property references a ConceptDescription then the ConceptDescription/category shall be one of following values: VALUE, PROPERTY." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Property> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "VALUE" && ?category != "PROPERTY")
		}
        """ ;
] .

# AASd-053
aas:ConceptDescriptionReferencedFromRangeAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:Range ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a Range submodel element references a ConceptDescription then the ConceptDescription/category shall be one of following values: PROPERTY." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Range> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "PROPERTY")
		}
        """ ;
] .

# AASd-054
aas:ConceptDescriptionReferencedFromReferenceElementAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:ReferenceElement ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a ReferenceElement submodel element references a ConceptDescription then the ConceptDescription/category shall be one of following values: REFERENCE." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/ReferenceElement> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "REFERENCE")
		}
        """ ;
] .

# AASd-055-RelationshipElement
aas:ConceptDescriptionReferencedFromRelationshipElementAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:RelationshipElement ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a RelationshipElement or an AnnotatedRelationshipElement submodel element references a ConceptDescription then the ConceptDescription/category shall be one of following values: RELATIONSHIP." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/RelationshipElement> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "RELATIONSHIP")
		}
        """ ;
] .

# AASd-055-AnnotatedRelationshipElement
aas:ConceptDescriptionReferencedFromAnnotatedRelationshipElementAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:AnnotatedRelationshipElement ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a RelationshipElement or an AnnotatedRelationshipElement submodel element references a ConceptDescription then the ConceptDescription/category shall be one of following values: RELATIONSHIP." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/AnnotatedRelationshipElement> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "RELATIONSHIP")
		}
        """ ;
] .

# AASd-056
aas:ConceptDescriptionReferencedFromEntityAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:Entity ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a Entity submodel element references a ConceptDescription then the ConceptDescription/category shall be one of following values: ENTITY." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Entity> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "ENTITY")
		}
        """ ;
] .

# AASd-057-File
aas:ConceptDescriptionReferencedFromFileAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:File ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "The semanticId of a File or Blob submodel element shall only reference a ConceptDescription with the category DOCUMENT." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/File> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "DOCUMENT")
		}
        """ ;
] .

# AASd-057-Blob
aas:ConceptDescriptionReferencedFromFileAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:Blob ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "The semanticId of a File or Blob submodel element shall only reference a ConceptDescription with the category DOCUMENT." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Blob> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "DOCUMENT")
		}
        """ ;
] .

# AASd-058
aas:ConceptDescriptionReferencedFromCapabilityAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:Capability ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a Capability submodel element references a ConceptDescription then the ConceptDescription/category shall be CAPABILITY." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Capability> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "CAPABILITY")
		}
        """ ;
] .


# AASd-060
aas:ConceptDescriptionReferencedFromSubmodelElementCollectionAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:Operation ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a Operation submodel element references a ConceptDescription then the category of the ConceptDescription shall be one of the following values: FUNCTION." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Operation> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "FUNCTION")
		}
        """ ;
] .

# AASd-061
aas:ConceptDescriptionReferencedFromEventAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:Operation ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a Event submodel element references a ConceptDescription then the category of the ConceptDescription shall be one of the following: EVENT." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Event> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "EVENT")
		}
        """ ;
] .


# AASd-063
aas:ConceptDescriptionReferencedFromQualifierAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:Qualifier ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a Qualifier references a ConceptDescription then the ConceptDescription/category shall be one of following values: QUALIFIER." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Qualifier> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "QUALIFIER")
		}
        """ ;
] .

# AASd-064
aas:ConceptDescriptionReferencedFromViewAllowedCategories a sh:NodeShape ;
  sh:targetClass aas:View ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a View references a ConceptDescription then the category of the ConceptDescription shall be VIEW." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/View> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "VIEW")
		}
        """ ;
] .

# AASd-067
aas:AASd-067Shape  a sh:NodeShape ;
  sh:targetClass aas:MultiLanguageProperty;
  sh:sparql [
    a sh:SPARQLConstraint ;
	sh:prefixes [
    sh:declare [
        sh:prefix "iec61360" ;
        sh:namespace "https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/"^^xsd:anyURI ;
      ]
    ];
    sh:message "If the semanticId of a MultiLanguageProperty references a ConceptDescription then DataSpecificationIEC61360/dataType shall be STRING_TRANSLATABLE." ;
    sh:select """
      SELECT  ?dataType
         WHERE {
           ?MultiLanguageProperty a <https://admin-shell.io/aas/3/0/RC01/MultiLanguageProperty> .
           ?MultiLanguageProperty <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticId .
           ?semanticId <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?key .
           ?key <https://admin-shell.io/aas/3/0/RC01/Key/value> ?keyValue .

           ?ConceptDescription <https://admin-shell.io/aas/3/0/RC01/HasDataSpecification/embeddedDataSpecification> ?embeddedDataSpecification .
           ?embeddedDataSpecification <https://admin-shell.io/aas/3/0/RC01/EmbeddedDataSpecification/dataSpecificationContent> ?dataSpecificationContent .
           ?dataSpecificationContent <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataSpecificationIEC61360/dataType> ?dataType .
           ?ConceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?identifier .
           ?identifier <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?identifierValue .

           FILTER ( ?keyValue = ?identifierValue )
           FILTER (?dataType != <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataTypeIEC61360/STRING_TRANSLATABLE>)
      }
          """ ;
] .

# AASd-68
aas:AASd-068Shape  a sh:NodeShape ;
  sh:targetClass aas:Range;
  sh:sparql [
    a sh:SPARQLConstraint ;
    sh:message "If the semanticId of a Range submodel element references a ConceptDescription then DataSpecificationIEC61360/dataType shall be a numerical one, i.e. REAL_* or RATIONAL_*." ;
    sh:prefixes [
      sh:declare [
        sh:prefix "iec61360" ;
        sh:namespace "https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/"^^xsd:anyURI ;
      ]
    ];
    sh:select """
      SELECT  ?dataType
         WHERE {
           ?range a <https://admin-shell.io/aas/3/0/RC01/Range> .
           ?range <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticId .
           ?semanticId <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?key .
           # ?key <https://admin-shell.io/aas/3/0/RC01/Key/type> <https://admin-shell.io/aas/3/0/RC01/IdentifiableElements/ConceptDescription> .
           ?key <https://admin-shell.io/aas/3/0/RC01/Key/value> ?keyValue .

           ?ConceptDescription <https://admin-shell.io/aas/3/0/RC01/HasDataSpecification/embeddedDataSpecification> ?embeddedDataSpecification .
           ?embeddedDataSpecification <https://admin-shell.io/aas/3/0/RC01/EmbeddedDataSpecification/dataSpecificationContent> ?dataSpecificationContent .
           ?dataSpecificationContent <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataSpecificationIEC61360/dataType> ?dataType .
           ?ConceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?identifier .
           ?identifier <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?identifierValue .

           FILTER ( ?keyValue = ?identifierValue  )

           FILTER (?dataType NOT IN (
             <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataTypeIEC61360/REAL_CURRENCY>, # TODO: should be RealCount
             <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataTypeIEC61360/REAL_COUNT>, # TODO: should be RealCount
             <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataTypeIEC61360/REAL_Measure>, # TODO: should be RealMeasure
             <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataTypeIEC61360/RATIONAL>, # TODO: should be Rational
             <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataTypeIEC61360/RATIONAL_MEASURE> # TODO: should be RationalMeasure
           ))

      }
          """ ;
] .

# AASd-069
aas:ConceptDescriptionReferencedFromRangeCorrectLevelType a sh:NodeShape ;
  sh:targetClass aas:Range ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "If the semanticId of a Range references a ConceptDescription then DataSpecificationIEC61360/levelType shall be identical to the set {Min, Max}." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Range> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/HasDataSpecification/embeddedDataSpecification> ?embeddedDataSpecification .
			?embeddedDataSpecification <https://admin-shell.io/aas/3/0/RC01/EmbeddedDataSpecification/dataSpecificationContent> ?dataSpecificationContent .
			?dataSpecificationContent <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataSpecificationIEC61360/levelType> ?levelType .
			FILTER(?levelType NOT IN (<https://admin-shell.io/aas/3/0/RC01/LevelType/MAX>, <https://admin-shell.io/aas/3/0/RC01/LevelType/MIN>))
		}
        """ ;
] .

# AASd-072
aas:ConceptDescriptionWithCategoryDocumentAndIEC61360CorrectDataType a sh:NodeShape ;
  sh:targetClass aas:ConceptDescription;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "For a ConceptDescription with category DOCUMENT using data specification template IEC61360 (http://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/2/0) - DataSpecificationIEC61360/dataType shall be one of the following values: STRING or URL." ;

  sh:select """
  	SELECT ?conceptDescription
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> "DOCUMENT" .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/HasDataSpecification/embeddedDataSpecification> ?embeddedDataSpecification .
			?embeddedDataSpecification <https://admin-shell.io/aas/3/0/RC01/EmbeddedDataSpecification/dataSpecificationContent> ?dataSpecificationContent .
			?dataSpecificationContent <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataSpecificationIEC61360/dataType> ?dataType .
			FILTER(?dataType != <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataTypeIEC61360/URL> && ?dataType != <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataTypeIEC61360/STRING>)
		}
        """ ;
] .

# AASd-074
aas:ConceptDescriptionDefinitionInEnglishIfNotValueCategory a sh:NodeShape ;
  sh:targetClass aas:ConceptDescription ;
  sh:message "For all ConceptDescriptions except for ConceptDescriptions of category VALUE using data specification template IEC61360 (http://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/2/0) - DataSpecificationIEC61360/definition is mandatory and shall be defined at least in English." ^^xsd:string ;
	sh:or(
	[
		sh:or(
			[
			sh:property [
			a sh:PropertyShape ;
			sh:path <https://admin-shell.io/aas/3/0/RC01/HasDataSpecification/embeddedDataSpecification> ;
			sh:class aas:EmbeddedDataSpecification ;
			sh:minCount 1 ;
			sh:property [
				a sh:PropertyShape ;
				sh:path <https://admin-shell.io/aas/3/0/RC01/EmbeddedDataSpecification/dataSpecificationContent> ;
				sh:class aas:DataSpecificationContent ;
				sh:minCount 1 ;
					sh:property [
						a sh:PropertyShape ;
						sh:path <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataSpecificationIEC61360/definition> ;
						sh:minCount 1 ;
						sh:languageIn ("en");
					] ;
				] ;
			];
			]
			[
				sh:property [
				a sh:PropertyShape ;
				sh:path <https://admin-shell.io/aas/3/0/RC01/HasDataSpecification/embeddedDataSpecification> ;
				sh:class aas:EmbeddedDataSpecification ;
				sh:maxCount 0 ;
				]
			]
		)
	]
	[
		sh:property [
			a sh:PropertyShape ;
			sh:path <https://admin-shell.io/aas/3/0/RC01/Referable/category> ;
			sh:datatype xsd:string ;
			sh:maxCount 1 ;
			sh:minCount 1 ;
			sh:pattern "^VALUE";
		];
	]
)
.


# AASd-076
aas:ConceptDescriptionPreferredNameInEnglish a sh:NodeShape ;
  sh:targetClass aas:ConceptDescription ;
  sh:message "For all ConceptDescriptions using data specification template IEC61360 (http://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/2/0) at least a preferred name in English shall be defined." ^^xsd:string ;
  sh:or(
  	[
	  	sh:property [
			a sh:PropertyShape ;
			sh:path <https://admin-shell.io/aas/3/0/RC01/HasDataSpecification/embeddedDataSpecification> ;
			sh:class aas:EmbeddedDataSpecification ;
			sh:minCount 1 ;
			sh:property [
				a sh:PropertyShape ;
				sh:path <https://admin-shell.io/aas/3/0/RC01/EmbeddedDataSpecification/dataSpecificationContent> ;
				sh:class aas:DataSpecificationContent ;
				sh:minCount 1 ;
					sh:property [
						a sh:PropertyShape ;
						sh:path <https://admin-shell.io/DataSpecificationTemplates/DataSpecificationIEC61360/3/0/RC01/DataSpecificationIEC61360/preferredName> ;
						sh:minCount 1 ;
						sh:languageIn ("en");
					] ;
				] ;
		]
	]
	[
		sh:property [
			a sh:PropertyShape ;
			sh:path <https://admin-shell.io/aas/3/0/RC01/HasDataSpecification/embeddedDataSpecification> ;
			sh:class aas:EmbeddedDataSpecification ;
			sh:maxCount 0 ;
		];
	]
) .


# AASd-077
aas:UniqueExtensionNames a sh:NodeShape ;
  sh:targetClass aas:HasExtensions ;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "The name of an extension within HasExtensions needs to be unique." ;

  sh:select """
  	SELECT ?extensionName
  		WHERE {
			?extension1 a <https://admin-shell.io/aas/3/0/RC01/Extension> .
      ?extension1 <https://admin-shell.io/aas/3/0/RC01/Extension/name> ?extension1Name .

			?extension2 a <https://admin-shell.io/aas/3/0/RC01/Extension> .
      ?extension2 <https://admin-shell.io/aas/3/0/RC01/Extension/name> ?extension2Name .

      ?hasExtensions <https://admin-shell.io/aas/3/0/RC01/HasExtensions/extension> ?extension1 .
      ?hasExtensions <https://admin-shell.io/aas/3/0/RC01/HasExtensions/extension> ?extension2 .

			FILTER(?extension1Name = ?extension2Name )
		}
        """ ;
] .

# AASd-080
aas:KeyWithGlobalReferenceTypeCorrectIdType a sh:NodeShape ;
  sh:targetClass aas:Key;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "In case Key/type == GlobalReference idType shall not be any LocalKeyType (IdShort, FragmentId)." ;

  sh:select """
  	SELECT ?element
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Key> .
			?element <https://admin-shell.io/aas/3/0/RC01/Key/type> ?keyType .
			FILTER(?keyType = <https://admin-shell.io/aas/3/0/RC01/KeyElements/GLOBAL_REFERENCE>)
			?element <https://admin-shell.io/aas/3/0/RC01/Key/idType> ?keyIdType .
			FILTER(?keyIdType = <https://admin-shell.io/aas/3/0/RC01/KeyType/ID_SHORT> || ?keyIdType =  <https://admin-shell.io/aas/3/0/RC01/KeyType/FRAGMENT_ID>)
		}
        """ ;
] .

# AASd-081
aas:KeyWithAssetAdministrationShellTypeCorrectIdType a sh:NodeShape ;
  sh:targetClass aas:Key;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "In case Key/type==AssetAdministrationShell Key/idType shall not be any LocalKeyType (IdShort, FragmentId)." ;

  sh:select """
  	SELECT ?element
  		WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/Key> .
			?element <https://admin-shell.io/aas/3/0/RC01/Key/type> ?keyType .
			FILTER(?keyType = <https://admin-shell.io/aas/3/0/RC01/KeyElements/ASSET_ADMINISTRATION_SHELL>)
			?element <https://admin-shell.io/aas/3/0/RC01/Key/idType> ?keyIdType .
			FILTER(?keyIdType = <https://admin-shell.io/aas/3/0/RC01/KeyType/ID_SHORT> || ?keyIdType =  <https://admin-shell.io/aas/3/0/RC01/KeyType/FRAGMENT_ID>)
		}
        """ ;
] .

# AASd-090
aas:DataElementExcludingFileAndBlobCorrectCategory a sh:NodeShape ;
  sh:targetClass aas:DataElement;
  sh:sparql [
  a sh:SPARQLConstraint ;
  sh:message "For data elements DataElement/category shall be one of the following values: CONSTANT, PARAMETER or VARIABLE. Exception: File and Blob data elements." ;
  sh:prefixes rdf: ;
  sh:select """
  	SELECT ?element
  		WHERE {
  		 	?subclass <http://www.w3.org/2000/01/rdf-schema#subClassOf>+  <https://admin-shell.io/aas/3/0/RC01/DataElement> .
			FILTER(?subclass != <https://admin-shell.io/aas/3/0/RC01/File> && ?subclass != <https://admin-shell.io/aas/3/0/RC01/Blob>)
			?element a ?subclass .
			?element <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER(?category != "CONSTANT" && ?category != "PARAMETER" && ?category != "VARIABLE")
		}
        """ ;
] .


# AASd-092
# Also covers part of AASd-059. Full coverage is achieved in combination with AASd-093
aas:ConceptDescriptionReferencedFromSubmodelElementCollectionNoDuplicates  a sh:NodeShape ;
  sh:targetClass aas:SubmodelElementCollection;
  sh:sparql [
    a sh:SPARQLConstraint ;
    sh:message "If the semanticId of a SubmodelElementCollection with SubmodelElementCollection/allowDuplicates == false references a ConceptDescription then the ConceptDescription/category shall be ENTITY." ;
    sh:prefixes rdf: ;
    sh:select """
      SELECT ?element
         WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/SubmodelElementCollection> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "ENTITY")
			?element <https://admin-shell.io/aas/3/0/RC01/SubmodelElementCollection/allowDuplicates> ?duplicates .
			FILTER(?duplicates != "false")
      }
          """ ;
] .

# AASd-093
# Also covers part of AASd-059. Full coverage is achieved in combination with AASd-092
aas:ConceptDescriptionReferencedFromSubmodelElementCollectionAllowedDuplicates  a sh:NodeShape ;
  sh:targetClass aas:SubmodelElementCollection;
  sh:sparql [
    a sh:SPARQLConstraint ;
    sh:message "If the semanticId of a SubmodelElementCollection with SubmodelElementCollection/allowDuplicates == true references a ConceptDescription then the ConceptDescription/category shall be COLLECTION." ;
    sh:prefixes rdf: ;
    sh:select """
      SELECT ?element
         WHERE {
			?element a <https://admin-shell.io/aas/3/0/RC01/SubmodelElementCollection> .
			?element <https://admin-shell.io/aas/3/0/RC01/HasSemantics/semanticId> ?semanticIdReference .
			?semanticIdReference <https://admin-shell.io/aas/3/0/RC01/Reference/key> ?semanticIdKey .
			?semanticIdKey <https://admin-shell.io/aas/3/0/RC01/Key/value> ?semanticIdKeyValue .
			?conceptDescription a <https://admin-shell.io/aas/3/0/RC01/ConceptDescription> .
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Identifiable/identification> ?conceptDescriptionId .
			?conceptDescriptionId <https://admin-shell.io/aas/3/0/RC01/Identifier/identifier> ?conceptDescriptionIdValue .
			FILTER (?conceptDescriptionIdValue = ?semanticIdKeyValue)
			?conceptDescription <https://admin-shell.io/aas/3/0/RC01/Referable/category> ?category .
			FILTER (?category != "COLLECTION")
			?element <https://admin-shell.io/aas/3/0/RC01/SubmodelElementCollection/allowDuplicates> ?duplicates .
			FILTER(?duplicates != "true")
      }
          """ ;
] .
